<!doctype html><html lang="pt-BR"><head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>Event Checker — Criar Evento</title>
<style>
  :root{
    --bg:#0b0f1a; --card:#121a2a; --muted:#7f8ba3; --txt:#e9edf5; --accent:#7c5cff;
    --ok:#2ecc71; --err:#ff6b6b; --bd:#23304a;
  }
  body{font-family:Inter,system-ui,Arial,sans-serif;background:linear-gradient(180deg,#0b0f1a,#0f1630);
       color:var(--txt); margin:0; min-height:100dvh; display:flex; align-items:flex-start; justify-content:center; padding:32px 16px}
  .wrap{width:100%; max-width:820px}
  .title{display:flex; align-items:center; gap:10px; margin-bottom:16px}
  .title h1{font-size:22px; margin:0}
  .card{background:var(--card); border:1px solid var(--bd); border-radius:16px; padding:20px; box-shadow:0 10px 30px rgba(0,0,0,.2)}
  label{display:block; margin:10px 0 6px; color:var(--muted); font-size:13px}
  input,select,textarea,button{
    width:100%; padding:12px; border:1px solid var(--bd); border-radius:10px; background:#0c1222; color:var(--txt);
    outline:none; transition:.2s border-color;
  }
  input:focus,select:focus,textarea:focus{border-color:var(--accent)}
  .grid2{display:grid; grid-template-columns:1fr 1fr; gap:14px}
  .row{display:flex; gap:12px; align-items:center}
  .chips{display:flex; gap:8px; flex-wrap:wrap; margin:6px 0 0}
  .chip{padding:6px 10px; border:1px solid var(--bd); border-radius:999px; font-size:12px; color:var(--muted)}
  .sub{font-size:12px; color:var(--muted)}
  .btn{background:var(--accent); border:none; cursor:pointer; font-weight:600}
  .btn:hover{filter:brightness(1.07)}
  .msg{margin-top:12px; font-size:14px}
  .ok{color:var(--ok)} .err{color:var(--err)}
  .links a{color:#b3c7ff; font-family:ui-monospace,Menlo,monospace; word-break:break-all}
  .swatch{width:40px; height:40px; border-radius:8px; border:1px solid var(--bd)}
  .hint{font-size:12px; color:var(--muted); margin-top:4px}
</style>
</head><body>
<div class="wrap">
  <div class="title">
    <svg width="22" height="22" viewBox="0 0 24 24" fill="none"><path d="M8 7h8M8 11h8M8 15h5" stroke="#b3c7ff" stroke-width="1.5" stroke-linecap="round"/><rect x="3" y="4" width="18" height="16" rx="3" stroke="#b3c7ff" stroke-width="1.5"/></svg>
    <h1>Event Checker — Criar Evento</h1>
  </div>

  <div class="card">
    <label>Título do evento*</label><input id="title" placeholder="Aniversário do João">
    <label>Nome do anfitrião*</label><input id="host_name" placeholder="Família Silva">

    <div class="grid2">
      <div>
        <label>Data do evento*</label>
        <input id="date" type="date">
        <div class="hint">Formato brasileiro (seu navegador mostra um seletor de calendário).</div>
      </div>
      <div>
        <label>Horário de início*</label>
        <input id="time" type="time" step="60" placeholder="18:00">
      </div>
    </div>

    <label>Local*</label><input id="location" placeholder="Rua das Flores, 123">
    <label>Observações (opcional)</label><textarea id="notes" rows="3" placeholder="Leve sua energia boa!"></textarea>

    <div class="grid2">
      <div>
        <label>Data limite de confirmação (opcional)</label>
        <input id="rsvp_deadline_date" type="date">
      </div>
      <div>
        <label>Horário do limite (opcional)</label>
        <input id="rsvp_deadline_time" type="time" step="60" placeholder="23:59">
        <div class="hint">Se não preencher, usaremos 24h antes do evento.</div>
      </div>
    </div>

    <div class="grid2">
      <div>
        <label>Cor primária (HEX)</label>
        <div class="row">
          <input id="color_primary" placeholder="#7c5cff" maxlength="7" style="flex:1">
          <input id="cp_picker" type="color" style="width:52px; padding:6px">
        </div>
        <div class="chips">
          <span class="chip">#7c5cff</span><span class="chip">#f97316</span><span class="chip">#22c55e</span><span class="chip">#06b6d4</span>
        </div>
      </div>
      <div>
        <label>Cor secundária (HEX)</label>
        <div class="row">
          <input id="color_secondary" placeholder="#0c1222" maxlength="7" style="flex:1">
          <input id="cs_picker" type="color" style="width:52px; padding:6px">
        </div>
        <div class="chips">
          <span class="chip">#0c1222</span><span class="chip">#fde68a</span><span class="chip">#eab308</span><span class="chip">#f43f5e</span>
        </div>
      </div>
    </div>

    <label>Contar “Talvez” nas métricas?</label>
    <select id="include_maybe_in_counts">
      <option value="false">Não</option>
      <option value="true">Sim</option>
    </select>

    <label>Solicitar e-mail do convidado?</label>
    <select id="ask_email">
      <option value="false">Não</option>
      <option value="true">Sim</option>
    </select>

    <button id="createBtn" class="btn" style="margin-top:16px">Criar evento</button>
    <div id="msg" class="msg"></div>
  </div>

  <div id="links" class="card" style="margin-top:16px; display:none">
    <h3>Links gerados</h3>
    <div class="links">
      <p><strong>Convidados:</strong> <a id="guestLink" target="_blank" rel="noopener"></a></p>
      <p><strong>Painel:</strong> <a id="hostLink" target="_blank" rel="noopener"></a></p>
    </div>
  </div>
</div>

<script>
const BASE_API = "https://event-checker-k47o.onrender.com";
const BASE_FRONT = location.origin + location.pathname.replace(/\/create\.html$/,'');

// Sincroniza color picker ↔ campo HEX
const cpInput = document.getElementById('color_primary');
const csInput = document.getElementById('color_secondary');
const cpPicker = document.getElementById('cp_picker');
const csPicker = document.getElementById('cs_picker');
cpPicker.addEventListener('input', () => cpInput.value = cpPicker.value);
csPicker.addEventListener('input', () => csInput.value = csPicker.value);
document.querySelectorAll('.chips .chip').forEach(ch => {
  ch.addEventListener('click', () => {
    const val = ch.textContent.trim();
    if (!cpInput.value) cpInput.value = val; else csInput.value = val;
  });
});

// Valida HEX simples (#rrggbb)
const hexOk = (s) => /^#[0-9a-fA-F]{6}$/.test((s||'').trim());

// Envia criação
document.getElementById('createBtn').onclick = async () => {
  const body = {
    title: v('title'), host_name: v('host_name'),
    date: v('date'), time: v('time'),
    location: v('location'), notes: v('notes') || null,

    // NOVO: servidor formata a data-limite
    rsvp_deadline_date: v('rsvp_deadline_date') || null,
    rsvp_deadline_time: v('rsvp_deadline_time') || null,

    color_primary: hexOk(v('color_primary')) ? v('color_primary') : null,
    color_secondary: hexOk(v('color_secondary')) ? v('color_secondary') : null,
    ask_email: v('ask_email') === 'true',
    include_maybe_in_counts: v('include_maybe_in_counts') === 'true'
  };

  if (!body.title || !body.host_name || !body.date || !body.time || !body.location) {
    return setMsg('Preencha os campos obrigatórios (título, anfitrião, data, horário e local).', 'err');
  }
  if ((body.rsvp_deadline_date && !body.rsvp_deadline_time) || (!body.rsvp_deadline_date && body.rsvp_deadline_time)) {
    return setMsg('Se informar data limite de confirmação, informe também o horário (e vice-versa).', 'err');
  }

  setMsg('Enviando...', '');
  try{
    const r = await fetch(`${BASE_API}/api/events`, {
      method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(body)
    });
    const j = await r.json();
    if(!r.ok) throw new Error(j.error || 'Falha ao criar');
    const guest = `${BASE_FRONT}/rsvp.html?e=${encodeURIComponent(j.event_id)}`;
    const host  = `${BASE_FRONT}/host.html?e=${encodeURIComponent(j.event_id)}&key=${encodeURIComponent((new URL(j.link_painel)).searchParams.get('key'))}`;
    showLinks(guest, host);
    setMsg('Evento criado com sucesso! ✅', 'ok');
  }catch(err){
    setMsg('Erro: ' + err.message, 'err');
  }
};

function v(id){ return document.getElementById(id).value.trim(); }
function setMsg(t, cls){ const el=document.getElementById('msg'); el.className='msg '+cls; el.textContent=t; }
function showLinks(guest, host){
  const g=document.getElementById('guestLink'); g.textContent=guest; g.href=guest;
  const h=document.getElementById('hostLink');  h.textContent=host;  h.href=host;
  document.getElementById('links').style.display='block';
}
</script>
</body></html>
